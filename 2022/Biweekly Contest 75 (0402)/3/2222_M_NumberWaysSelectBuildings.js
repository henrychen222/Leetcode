/**
 * 04/02/22 morning
 * https://leetcode.com/contest/biweekly-contest-75/problems/number-of-ways-to-select-buildings/
 */

const pr = console.log;

// Accepted --- reference: Heltion
const numberOfWays = (s) => op(s, '101') + op(s, '010')

const op = (s, t) => {
    let one = 0, two = 0, three = 0;
    for (const c of s) {
        if (c == t[2]) three += two;
        if (c == t[1]) two += one;
        if (c == t[0]) one++;
    }
    return three;
};

///////////////////////////////////////////////////////////////////////
function Bisect() {
    return { insort_right, insort_left, bisect_left, bisect_right }
    function insort_right(a, x, lo = 0, hi = null) {
        lo = bisect_right(a, x, lo, hi);
        a.splice(lo, 0, x);
    }
    function bisect_right(a, x, lo = 0, hi = null) { // > upper_bound
        if (lo < 0) throw new Error('lo must be non-negative');
        if (hi == null) hi = a.length;
        while (lo < hi) {
            let mid = parseInt((lo + hi) / 2);
            a[mid] > x ? hi = mid : lo = mid + 1;
        }
        return lo;
    }
    function insort_left(a, x, lo = 0, hi = null) {
        lo = bisect_left(a, x, lo, hi);
        a.splice(lo, 0, x);
    }
    function bisect_left(a, x, lo = 0, hi = null) { // >= lower_bound
        if (lo < 0) throw new Error('lo must be non-negative');
        if (hi == null) hi = a.length;
        while (lo < hi) {
            let mid = parseInt((lo + hi) / 2);
            a[mid] < x ? lo = mid + 1 : hi = mid;
        }
        return lo;
    }
}

let bi;
const numberOfWays1 = (s) => {
    let m0 = new Map(), m1 = new Map(), bi = new Bisect();
    let zero = [], one = [];
    for (let i = 0; i < s.length; i++) s[i] == '0' ? zero.push(i) : one.push(i);
    // pr(zero, one);
    for (const e of zero) { // find idx for zero
        let idx = bi.bisect_right(one, e);
        m0.set(e, idx);
    }
    for (const e of one) { // find idx for one
        let idx = bi.bisect_right(zero, e);
        m1.set(e, idx);
    }
    // pr(m0, m1);
    let res1 = cal(zero, one, m0, m1);
    let res2 = cal(one, zero, m1, m0);
    // pr(res1, res2)
    return res1 + res2;
};

// TLE
const cal = (zero, one, m0, m1) => {
    let res = 0;
    for (const i of zero) {
        let idx = m0.get(i);
        for (let j = idx; j < one.length; j++) {
            let k = m1.get(one[j]);
            let thirdType = zero.length - k;
            res += thirdType;
            // pr(i, one[j], zero[k], "thirdType", thirdType);
        }
    }
    return res;
};


// TLE
// const cal = (zero, one) => { // '010'  '101'
//     let res = 0, bi = new Bisect();
//     for (const i of zero) {
//         let idx = bi.bisect_right(one, i);
//         for (let j = idx; j < one.length; j++) {
//             let k = bi.bisect_right(zero, one[j]);
//             let thirdType = zero.length - k;
//             res += thirdType;
//             // pr(i, one[j], zero[k], "thirdType", thirdType);
//         }
//     }
//     return res;
// };

const main = () => {
    let s = "001101";
    let s2 = "11100"
    let debug1 = "0101101000001111000000101001011110010010111000100101011011100111110000001010011100101110100110010000001111000111010010110011111110010110001011100010010001110011100010000000110101011001010010101100010011000100110110110011001101100010101011110101111100010111111000011000011110100010100111101011001011001111010100101011100100110111010110110001100111110011110010000111110111001010110101100011011101110110100001000000100000001100001010101110001100000000100000010010101011110100101101111101000001001001000001101100010110100100011111111111011001000110011001100001011101001011110001011010000000001100100010100101110011111110111101001110010100110101101101110111010011000010000101101110110101111001100000110011101110110110011100100001110000001001010010110011111110101010001111010000100101000000101011101110110100001111100100110001010010110000101110001110110000001100110111101111111001111111110000000110000000100000011011011000001111100111010100000000101001110010000110100100011101101010001100000111010000111001100010111010101111000110011010111011011011101000101001111100010000110010010010010100011111000100101010011100011000001101010000111010101101010000011011111110010100111111001111100111111000001001111111011001110000010100001100101000100000011100100000010010110000101000011010111011110010101011110110001110111001100011101000100010000001110011010011100001101111111010000011110101110011000011101000010110011000010000001101000110101110011110011000110101101100100110011111111111101001000111000010110001001100010011110001110011010001001100110110001100100011100000011101101011100100111111000111110110111100010110010001010100001100101101010001001001001100100110111010110000110110000110001010000011100110000101010111010001010000110110001101000000100101000101000100011111001001000100000100010000100011010110000100000011010100010010101111000010110010000011001111110011100111101000000111010101101110011001111100001100010001100100010110110011110101011100110111001001011011010100100100100101000000111111010010011000101101001110010000011101000100111010000011110010100001001010010111111011101110000101101001000111011100010110011011101001001001101111000100001000001010001001010111111101101110010101110111100100001111011111101100010001010010110000110010010101000001100100001110101100011100011111010110110110110101101101111001001010100101111110110100110110001100001110110111010110001111010001110010110110010110011101111001010101001001011110001111100101110101101011011000100110101011110000001000101111110001010000111110001110100111011000111011100111110001111100000100100000101111110001011111110000100110110101001010010000010000111111000111101001101111000011111100011001100001111110100100101011011001100110110110001110100101010011111001111000100101101010000101111101000000111110101011111110100011101100101001111001111111010011000100100101111001110100010000001111110010100101010110011001101000111111100100100001110101110101101000001011100010111101011110110100001010001000110100001111110000000110100111001111000010100101110000000111110000111100011111111000100001011111110011010111100110111011101001011110111011101010011110011001111110101101111010001010001101110100111101101111101000110011011101100010010100001000001110011010110100000001011001110110010111111000000010001001010010110101001100110110111110000010011001011111110000111101111011001000110001111001111111001010011010100010010010000101010111101011010000010000111101000110101111001011100000101100100100001111111001010010111001100100110011101111010100110001011111101110011100101110001011011101101111110011001110111010110111011111110011000110001101110111001101001110110111011101100100000100001000011111101010100010101001111110011101001101110001000001011111010100100101100001111010011001110111000000011011101101111100000010101110001101010101110111000100100100110010100100101000100110111001100101001000011101101011010010000011100000110000001001101101100000111001101001000101110011111110011100110000010111110101111111110110111000010100101110001011010001001100111101110101111011101001111110011000100101010011111100011110011000011110101011100000010101101010001110001000010001001001110110111010101100100000100101001010011000011101000111000011100010011111110001100111110010110101110110010011010111001011011011001100001000001101101010001000100001110000001111111001000110000110101010110110011110110000011111101101110011110100000110110010010001101011011000001000011000010011010110011101110001001011100100010101101010111010011101010100010110001011000010010100000010011010101011100111011100010101101110110010001110010010101100010011001011100110010110110000110011000101111001111101011011111011100000101001110110000001000100000010100110110100100000000001111100000000110101001000110000011111000000100001110101100111100101111000111111011001011001010111100110010010011101111011000111011010101100110001000101011010001011011101100111111101101000000111011000100110110110111011010100011010000110010010101100011000110011011001110010101011011010010110110000110111111111100110111010011100110111001000110011101101000010000100011001000101000100001111101101011011100011001001101101010101100100011100111110100111100010010000100001101100100111010011010111101100101000110110011001111100100010110111010010110001000101010111110110010100111010011111100000000000110101010000001000001011001110011100000000001111011110010010000010010100101100100001010000010110101001010001001101001011111111000101111011000001100010010011111000011000001010000000111000011111000110001000101010001101101110011001101100111000111010100000110001011101101001100100101001011100011011101101100111000110001100111000111011000100001100010001010100101001011111101111001101011100101000010010001101101110101011010001100011111100100000011010110011100101011010111101011111101100110110010010110110100000000110011100100010010001001110001110011110111011101000101001111101100011100111111101001010111101011010010101111100000011110110101110001000111011110101100010000001011010101111000010010001111000001001000001100101011001110011100000110101001111101011000101011110111001110111000100110000111100110101001100101110001111101000110101111110001101110100110101111110001110011100110110100101111000001011111101000100110110100000011100010111011100110001101010010111110000110000010100011001101111110111111001110100010110111100011000011100101000001011010011111000111111000000110011000001000011001000111000110111111011110";
    let debug2 = "0001100100";
    pr(numberOfWays(s))
    pr(numberOfWays(s2))
    pr(numberOfWays(debug1)) // 10719654494
    pr(numberOfWays(debug2)) // 38
};

main()